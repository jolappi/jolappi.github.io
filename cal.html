<!DOCTYPE html>
<html lang='en' class=''>
    <head>
        <meta charset='UTF-8'>
        <meta name="robots" content="noindex">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="shortcut icon" type="image/x-icon" href=""/>
        <link rel="mask-icon" type="" href="" color="#111"/>
        <link rel="canonical" href=""/>
        <!--link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css'-->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.3.2/fullcalendar.min.css'>
        <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
        <style>
        .boxeddiv {
            border-width:thin;
            border-style: solid;
        }
        .blue-ht {
            background-color:darkblue;
        }
        .wht {
            color:white;
        }
        .divdivider {
            height: 50px;
        }
        .bg-gray {
            background-color:#f9f9fb;
        }
        @media(max-width: 768px) {
            a.full-width {
            width: 100%;
        }
}
}
        </style>
    </head>
    <body>
        <div class="row divdivider"></div>
        <div class="row">
            <div class="col-sm-5 col-md-5 col-lg-5"></div>
            <div class="col-sm-5 col-md-2 col-lg-2 blue-ht">
                <center>
                    <br>
                    <h1 class="wht">Tilaa nouto tästä</h1>
                    <br>
                </center>
            </div>
            <div class="col-sm-5 col-md-5 col-lg-5"></div>
        </div>
        <div class="row divdivider"></div>
        <center>
            <h1>Kuinka paljon jätettä on</h1>
        </center>
        <div class="row">
            <div class="col-xs-12 col-md-3 col-lg-3"></div>
            <div id="pieninouto" class="col-xs-12 col-md-1 col-lg-1  btn-group">
                <a href="javascript:void(0)" class="boxeddiv full-width" id="pieninoutobtn" onclick="pieninouto()">
                    <center>
                    <img class="img-responsive" src="jh1.png" alt="Ei kuvaa"/>
                    <br>
                    <span id="pieninoutospan">
                    <strong><b>69 €</b></strong>
                    <p>Sis. max kahden esineen noudon<br><br></p>
                    <label id="valit1"><b>Valitse</b></label>
                    <span>
                    </center>
                </a>
            </div>
            <div class="col-xs-12 col-md-1 col-lg-1"></div>
            <div id="keskikoknouto" class="col-xs-1 col-md-1 col-lg-1 btn-group">
                <a href="javascript:void(0)" class="boxeddiv full-width" id="keskikoknoutobtn" onclick="keskikoknouto()">
                    <center>
                    <img class="img-responsive" src="jh2.png" alt="Ei kuvaa">
                    <br>
                    <span id="keskikoknoutospan">
                    <strong><b>89 €</b></strong>
                    <p>Sis. 3-4 esineen noudon<br><br></p>
                    <label id="valit2"><b>Valitse</b></label>
                    </span>
                    </center>
                </a>
            </div>
            <div class="col-xs-12 col-md-1 col-lg-1"></div>
            <div id="isonouto" class="col-sm-12 col-md-1 col-lg-1 btn-group">
                <a href="javascript:void(0)" class="boxeddiv full-width" id="isonoutobtn" onclick="isonouto()">
                    <center>
                    <img class="img-responsive" src="jh3.png" alt="Ei kuvaa">
                    <br>
                    <span id="isonoutospan">
                    <strong><b>44,35 €/h</b></strong>
                    <p>* jätteenkäsittely maksu jos enemmän tai irtotavaraa</p>
                    <label id="valit3"><b>Valitse</b></label>
                    </span>
                    </center>
                </a>
            </div>
            <div class="col-xs-12 col-md-4 col-lg-4"></div>
        </div>
        <div class="row divdivider"></div>
        <div class="row divdivider bg-gray"></div>
        <div class="row bg-gray">
            <div class="col-sm-5 col-md-2 col-lg-3"></div>
            <div class="col-sm-2 col-md-8 col-lg-6">
                <center>
                    <h1>Tarkista alueesi noutopäivät</h1>
                </center>
                <br>
                <div class="input-group">
                <span class="input-group-btn dropdown">
                    <button type="button" class="btn btn-outline-dark dropdown-toggle custom font-weight-bold" data-toggle="dropdown">Valitse nouto paikkakunta<span class="caret"></span></button>
                    <ul class="dropdown-menu pull-right">
                        <li><a data-value="tampere">Tampere</a></li>
                        <li><a data-value="pirkkala">Pirkkala</a></li>
                        <li><a data-value="ylöjärvi">Ylöjärvi</a></li>
                        <li><a data-value="nokia">Nokia</a></li>
                    </ul>
                </span>
                <label class="control-label col-sm-12 col-md-6 col-lg-6">Valitse paikkakunta niin vapaat noutoajat tulevat näkyviin</label>
                <div id='calendar'></div>
            </div>
            </div>
            <div class="col-sm-5 col-md-2 col-lg-3"></div>
        </div>
    <!--hr-->
    <!--hr-->
    <div class="row divdivider bg-gray"></div>
    <!-- Modal ->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Noudon tarkemmat tiedot</h5>
                </div-->
                <!-- TODO real submit -->
                <div class="row bg-gray">
                <div class="col-sm-5 col-md-2 col-lg-3"></div>
                <div class="col-sm-2 col-md-8 col-lg-6" >
                <form id="noutoreq" action="">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-3"></div>
                            <div class="col-md-6 form-inline">
                                <label>
                                    <span class="eqh"><strong>Nouto:</strong>
                                    <span id="spanni"></span>
                                    <input class="bg-gray d-none" type="text" id="paikka" style="border: 0px;" disabled="disabled">
                                    <input class="bg-gray d-none" type="text" id="pvm" style="border: 0px;" disabled="disabled">
                                    <input class="bg-gray d-none" type="text" id="klo" style="border: 0px;" disabled="disabled">
                                    </span>
                                </label>
                            </div>
                            <div class="col-md-3"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-3"></div>
                            <div class="col-md-6">
                                <label>
                                    <span class="eqh"><strong>Määrä:</strong>
                                    <input class="bg-gray" type="text" id="maara" style="border: 0px;" disabled="disabled">
                                    <span id="maara2"></span>
                                    </span>
                                </label>
                            </div>
                            <div class="col-md-3"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-3"></div>
                            <div class="col-md-6">
                                <label>
                                    <span class="eqh"><strong>Hinta:</strong>
                                    <input class="bg-gray" type="text" id="hinta" style="border: 0px;" disabled="disabled">
                                    </span>
                                </label>
                            </div>
                            <div class="col-md-3"></div>
                        </div>
                        <div class="row">
                            <div class="col-md-3"></div>
                            <div class="col-md-6">
                                <input class="col-md-12" type="text" id="nimi" placeholder="Nimi">
                            </div>
                            <div class="col-md-3"></div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-3"></div>
                            <div class="col-md-6">
                                <input class="col-md-12" type="address" id="osoite" placeholder="Osoite">
                            </div>
                            <div class="col-md-3"></div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-3"></div>
                            <div class="col-md-6">
                                <input class="col-md-12" type="email" id="email" placeholder="Sähköposti">
                            </div>
                            <div class="col-md-3"></div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-3"></div>
                            <div class="col-md-6">
                                <input class="col-md-12" type="phone" id="puhelin" placeholder="Puhelin">
                            </div>
                            <div class="col-md-3"></div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-3"></div>
                            <div class="col-md-6">
                                <textarea rows="4" class="col-md-12" id="lisatiedot" placeholder="Lisätietoa tai tarkennettavaa"></textarea>
                            </div>
                        <div class="col-md-3"></div>
                        </div>
                    </div>
                    <!--div class="modal-footer"-->
                    <div class="row">
                        <div class="offset-md-2 col-md-8 ">
                        <!--button type="button" class="btn btn-secondary" data-dismiss="modal">Hylkää</button-->
                        <center>
                        <button
                            type="button"
                            class="btn btn-primary"
                            onclick="writenoudot(
                            document.getElementById('pvm').value,
                            document.getElementById('osoite').value,
                            document.getElementById('puhelin').value,
                            document.getElementById('nimi').value,
                            document.getElementById('email').value,
                            document.getElementById('klo').value,
                            document.getElementById('lisatiedot').value,
                            document.getElementById('maara').value
                        )">Tee nouto pyyntö</button></center>
                        </div>
                    </div>
                    <div class="row divdivider"></div>
                </form>
            </div>
        </div
            <!--/div>
        </div>
    </div-->
    <div id="varaukset"></div>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js'></script>
    <!--script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js'></script-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.3.2/fullcalendar.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/2.3.2/lang/fi.js'></script>
    <script id="rendered-js">
        function remclasses(){
            $('#pieninoutobtn').removeClass("blue-ht");
            $('#pieninoutospan').removeClass("wht");
            $('#keskikoknoutobtn').removeClass("blue-ht");
            $('#keskikoknoutospan').removeClass("wht");
            $('#isonoutobtn').removeClass("blue-ht");
            $('#isonoutospan').removeClass("wht");
            $('#valit1').html("<b>Valitse</b>");
            $('#valit2').html("<b>Valitse</b>");
            $('#valit3').html("<b>Valitse</b>");
        }
        function pieninouto(){
            remclasses();
            $('#hinta').val("69€");
            $('#maara').val('enintään kaksi esinettä');
            $('#maara2').html('(sis. kuljetuksen, jätteenkäsittelymaksun ja verot)');
            $('#pieninoutobtn').addClass("blue-ht");
            $('#pieninoutospan').addClass("wht");
            $('#valit1').html("<b>Valittu</b>");
        }
        function keskikoknouto(){
            remclasses();
            $('#hinta').val("89€");
            $('#maara').val('3-4 esinettä');
            $('#maara2').html('(sis. kuljetuksen, jätteenkäsittelymaksun ja verot)');
            $('#keskikoknoutobtn').addClass("blue-ht");
            $('#keskikoknoutospan').addClass("wht");
            $('#valit2').html("<b>Valittu</b>");
        }
        function isonouto(){
            remclasses();
            $('#hinta').val("44,35€/h");
            $('#maara').val('enemmän kuin 4 esinettä');
            $('#maara2').html('');
            $('#isonoutobtn').addClass("blue-ht");
            $('#isonoutospan').addClass("wht");
            $('#valit3').html("<b>Valittu</b>");
        }
        $(".dropdown-menu li a").click(function(){
            console.log($(this).data('value'));
            $(this).parents(".dropdown").find('.btn').html($(this).text() + ' <span class="caret"></span>');
            $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
            haepvmt($(this).data('value'));
        });
        var pk = "";
        var bgcolo = '#004895';
        var bgbgcolo = '#CEE2FE';
        var txtcolo = 'white';
        var linerets = '';
        function haepvmt(paikka) {
            //TODO
            pk = paikka;
            getpaikat(pk);
            //alert('haetaan '+paikka+'n ajat'); on single day events startdate=enddate exceptiondates is list ['YYYY-MM-DD',...] addEvnt(startdate,enddate,exceptiondates,title,description);
        };
        $(document).ready(function () {
            //var selectedevent = null; page is now ready, initialize the calendar..
            $('#calendar').fullCalendar({
                height: 'auto',
                width: 'auto',
                aspectRatio: 1,
                weekends: true,
                firstDay: 1,
                defaultView: 'month',
                eventTextColor: txtcolo,
                titleFormat: {
                    day: 'DD.MM.YYYY' //whatever date format you want here
                },
                dayClick: function () {
                    if (!pk) {
                        alert('Valitse paikkakunta ensin!');
                        return;
                    }
                    alert('Tällä päivälle ei ole aikoja!');
                },
                eventClick: function (evnt) {
                    //selectedevent = evnt;
                    if (!pk) {
                        alert('Valitse paikkakunta ensin!');
                        return;
                    }
                    $('#pvm').val(evnt.start.format('DD.MM.YYYY'));
                    $('#paikka').val(pk);
                    //$('#myModal').modal('toggle');
                    $('#klo').val(evnt.title);
                    $('#spanni').html($('#pvm').val()+', '+$('#paikka').val()+', '+$('#klo').val());
                },
                eventAfterRender: function (event, element, view) {},
                eventRender: function (eventObj, $el) {
                    $el.popover({title: eventObj.title, content: eventObj.description, trigger: 'hover', placement: 'top', container: 'body'});
                    //This is for showing description in calendar $el.find('.fc-title').append('<div class="hr-line-solid-no-margin"></div><span>' + eventObj.description + linerets + '</span></div>');
                },
                eventMouseover: function (event, jsEvent, view) {}
            });

            // TODO testing only, remove from production addEvnt(new Date(),moment(new Date()).add(30,'d'), ['2019-03-18'], "11:00\n15:00", "Pirkkala,\nIso auto"); addEvnt(moment(new Date()).add(2,'d'),moment(new Date()).add(100,'d'), ['2019-03-27'],
            // "08:00\n11:00", "Pirkkala,\nPikku auto");
        });
        function addEvnt(indatestart, indateend, igndates, title, description) {
            var max = 200;
            var tempDate = indatestart;
            var i = 0;
            while (max > 0 && moment(indateend).isAfter(tempDate)) {
                max = max - 1;
                var sdate = moment(indatestart).add(7 * i, 'd');
                tempDate = sdate;
                var fsdate = moment(sdate).format('YYYY-MM-DD');
                if ($.inArray(fsdate, igndates) == -1) {
                    var event = {
                        id: 1,
                        title: title,
                        start: fsdate,
                        end: fsdate,
                        description: description,
                        color: bgcolo
                    };
                    $('#calendar').fullCalendar('renderEvent', event, true);
                    var bgevent = {
                        id: 1,
                        title: title,
                        start: fsdate,
                        end: fsdate,
                        description: description,
                        color: bgbgcolo,
                        rendering: 'background'
                    };
                    $('#calendar').fullCalendar('renderEvent', bgevent, true);
                }
                i = i + 1;
            }
        };
    </script>
</body>
<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/5.8.6/firebase.js"></script>
<script>
    // Initialize Firebase
    // TODO: Replace with your project's customized code snippet
    var config = {
        apiKey: "AIzaSyAvzTNPrudlKMhuE8d5sbp0IbrItqR2MTE",
        authDomain: "",
        databaseURL: "https://messageinthebottle-4d3dc.firebaseio.com"
    };
    firebase.initializeApp(config);

    var database = firebase.database();
    function getpaikat(paikka) {
        pk = paikka;
        $('#calendar').fullCalendar('removeEvents');
        firebase.database().ref('/dates/' + paikka + '/noutopvmt/').once('value').then(function (snapshot) {
            var daatta = snapshot.val();
            if (!daatta) {
                alert('Ei aikoja tälle paikkakunnalle!');
                return;
            }
            for (var ii = 0; ii < Object.keys(daatta).length; ii++) {
                var datas = daatta[Object.keys(daatta)[ii]];
                var sdate = moment(datas.startdate, 'DD.MM.YYYY').toDate();
                var edate = moment(datas.enddate, 'DD.MM.YYYY').toDate();
                var tit = datas.title;
                var desc = datas.description;
                addEvnt(sdate, edate, [''], tit, desc);
            }
        });
        firebase.database().ref('/dates/' + paikka + '/noudot/').once('value').then(function (snapshot) {
            var daatta = snapshot.val();
            if (!daatta) {
                //alert('Ei aikoja tälle paikkakunnalle!');
                return;
            }
            $('#varaukset').html('');
            for (var ii = 0; ii < Object.keys(daatta).length; ii++) {
                var datas = daatta[Object.keys(daatta)[ii]];
                $('#varaukset').html($('#varaukset').html() + '<center>' + datas.pvm + ' ' + datas.osoite + ' ' + datas.nimi + ' </center><br>');
            }
        });
    }
    function writenoudot(pvm, osoite, puhelin, nimi, email, klo, lisatiedot,maara) {
        if (!maara) {
            alert('määrä puuttuu');
            return;
        }
        if (!pvm) {
            alert('valitse paikkakunta ja pvm ja aika kalenterista');
            return;
        }
        if (!nimi) {
            alert('nimi puuttuu');
            return;
        }
        if (!osoite) {
            alert('osoite puuttuu');
            return;
        }
        if (!email) {
            alert('email puuttuu');
            return;
        }
        if (!puhelin) {
            alert('puhelin puuttuu');
            return;
        }
        //$('#myModal').modal('toggle');
        var nodotpvm = pvm.replace(/\./g, '');
        console.log(nimi,osoite,pvm,email,puhelin,klo,lisatiedot);
        firebase.database().ref('/dates/' + pk + '/noudot/' + nodotpvm + osoite + nimi + '/').set({
            nimi: nimi,
            osoite: osoite,
            pvm: pvm,
            email: email,
            puhelin: puhelin,
            klo: klo,
            lisatiedot: lisatiedot
        });
        alert('Nouto pyyntö talletettu');
        getpaikat(pk);
    }
    //TODO function for saving to /dates/+paikka+/varatutnoudot/
</script>

</html>
